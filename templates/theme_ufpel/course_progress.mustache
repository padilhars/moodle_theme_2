{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @template theme_ufpel/course_progress

    Template para exibição de progresso do curso no tema UFPel.
    
    Este template renderiza uma barra de progresso visualmente atrativa
    com cores institucionais e informações de conclusão do curso.
    
    Variáveis do contexto:
    * courseid - ID do curso
    * has_progress - Flag indicando se há dados de progresso
    * progress_percentage - Porcentagem de conclusão (0-100)
    * progress_class - Classe CSS baseada no nível de progresso

    @package theme_ufpel
    @copyright 2025 Universidade Federal de Pelotas
    @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
}}

{{#has_progress}}
<div class="ufpel-course-progress-container mb-4" role="region" aria-label="{{#str}}courseprogress, theme_ufpel{{/str}}">
    
    {{! Cabeçalho da seção de progresso }}
    <div class="ufpel-progress-header d-flex justify-content-between align-items-center mb-2">
        <h3 class="h6 mb-0 text-ufpel-primary fw-semibold">
            <i class="fa fa-chart-line me-2" aria-hidden="true"></i>
            {{#str}}courseprogress, theme_ufpel{{/str}}
        </h3>
        
        <span class="badge {{progress_class}} fw-bold" 
              aria-label="{{#str}}progresspercentage, theme_ufpel{{/str}}: {{progress_percentage}}%">
            {{progress_percentage}}%
        </span>
    </div>
    
    {{! Barra de progresso principal }}
    <div class="ufpel-progress-wrapper position-relative">
        <div class="progress ufpel-progress-bar" 
             role="progressbar" 
             aria-valuenow="{{progress_percentage}}" 
             aria-valuemin="0" 
             aria-valuemax="100"
             aria-label="{{#str}}courseprogress, theme_ufpel{{/str}}: {{progress_percentage}}%">
            
            <div class="progress-bar {{progress_class}} progress-bar-striped progress-bar-animated" 
                 style="width: {{progress_percentage}}%"
                 data-progress="{{progress_percentage}}">
                
                {{! Texto dentro da barra (para progresso alto) }}
                {{#progress_percentage}}
                {{#progress_high}}
                <span class="ufpel-progress-text small fw-bold">
                    {{progress_percentage}}%
                </span>
                {{/progress_high}}
                {{/progress_percentage}}
            </div>
        </div>
        
        {{! Marcadores de milestone }}
        <div class="ufpel-progress-milestones">
            <div class="milestone" style="left: 25%" title="{{#str}}milestone25, theme_ufpel{{/str}}">
                <div class="milestone-marker {{#progress_25_reached}}reached{{/progress_25_reached}}"></div>
            </div>
            <div class="milestone" style="left: 50%" title="{{#str}}milestone50, theme_ufpel{{/str}}">
                <div class="milestone-marker {{#progress_50_reached}}reached{{/progress_50_reached}}"></div>
            </div>
            <div class="milestone" style="left: 75%" title="{{#str}}milestone75, theme_ufpel{{/str}}">
                <div class="milestone-marker {{#progress_75_reached}}reached{{/progress_75_reached}}"></div>
            </div>
            <div class="milestone" style="left: 100%" title="{{#str}}milestone100, theme_ufpel{{/str}}">
                <div class="milestone-marker {{#progress_100_reached}}reached{{/progress_100_reached}}"></div>
            </div>
        </div>
    </div>
    
    {{! Informações detalhadas de progresso }}
    <div class="ufpel-progress-details mt-3">
        <div class="row g-2 small text-muted">
            
            {{! Atividades concluídas }}
            {{#completed_activities}}
            <div class="col-6 col-md-3">
                <div class="d-flex align-items-center">
                    <i class="fa fa-check-circle text-success me-1" aria-hidden="true"></i>
                    <span>{{completed_activities}} {{#str}}completed, theme_ufpel{{/str}}</span>
                </div>
            </div>
            {{/completed_activities}}
            
            {{! Total de atividades }}
            {{#total_activities}}
            <div class="col-6 col-md-3">
                <div class="d-flex align-items-center">
                    <i class="fa fa-list text-info me-1" aria-hidden="true"></i>
                    <span>{{total_activities}} {{#str}}total, theme_ufpel{{/str}}</span>
                </div>
            </div>
            {{/total_activities}}
            
            {{! Tempo estimado restante }}
            {{#estimated_time}}
            <div class="col-6 col-md-3">
                <div class="d-flex align-items-center">
                    <i class="fa fa-clock text-warning me-1" aria-hidden="true"></i>
                    <span>{{estimated_time}} {{#str}}remaining, theme_ufpel{{/str}}</span>
                </div>
            </div>
            {{/estimated_time}}
            
            {{! Data de conclusão prevista }}
            {{#completion_date}}
            <div class="col-6 col-md-3">
                <div class="d-flex align-items-center">
                    <i class="fa fa-calendar text-primary me-1" aria-hidden="true"></i>
                    <span>{{completion_date}}</span>
                </div>
            </div>
            {{/completion_date}}
        </div>
    </div>
    
    {{! Mensagem motivacional baseada no progresso }}
    {{#progress_message}}
    <div class="ufpel-progress-message mt-3 p-3 rounded {{progress_message_class}}">
        <div class="d-flex align-items-start">
            <i class="{{progress_message_icon}} me-2 mt-1" aria-hidden="true"></i>
            <div class="flex-grow-1">
                <strong>{{progress_message_title}}</strong>
                <p class="mb-0 small">{{progress_message_text}}</p>
            </div>
        </div>
    </div>
    {{/progress_message}}
</div>

{{! CSS específico para o componente de progresso }}
<style>
.ufpel-course-progress-container {
    background: linear-gradient(135deg, rgba(0, 64, 143, 0.03) 0%, rgba(0, 128, 255, 0.03) 100%);
    border: 1px solid rgba(0, 64, 143, 0.1);
    border-radius: 0.5rem;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
}

.ufpel-progress-bar {
    height: 1.5rem;
    background-color: rgba(0, 64, 143, 0.1);
    border-radius: 0.75rem;
    overflow: visible;
    position: relative;
}

.ufpel-progress-bar .progress-bar {
    border-radius: 0.75rem;
    position: relative;
    transition: width 0.6s ease;
}

/* Classes de progresso baseadas em níveis */
.ufpel-progress-complete {
    background: linear-gradient(90deg, #28a745, #20c997) !important;
}

.ufpel-progress-high {
    background: linear-gradient(90deg, #0080FF, #00408F) !important;
}

.ufpel-progress-medium {
    background: linear-gradient(90deg, #F7A600, #ff8c00) !important;
}

.ufpel-progress-low {
    background: linear-gradient(90deg, #dc3545, #c82333) !important;
}

/* Badges de progresso */
.badge.ufpel-progress-complete {
    background-color: #28a745 !important;
    color: white;
}

.badge.ufpel-progress-high {
    background-color: #0080FF !important;
    color: white;
}

.badge.ufpel-progress-medium {
    background-color: #F7A600 !important;
    color: #343a40;
}

.badge.ufpel-progress-low {
    background-color: #dc3545 !important;
    color: white;
}

/* Texto dentro da barra de progresso */
.ufpel-progress-text {
    position: absolute;
    width: 100%;
    text-align: center;
    line-height: 1.5rem;
    color: white;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
}

/* Milestones */
.ufpel-progress-milestones {
    position: absolute;
    top: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
}

.milestone {
    position: absolute;
    top: -2px;
    transform: translateX(-50%);
}

.milestone-marker {
    width: 8px;
    height: 8px;
    background-color: #dee2e6;
    border: 2px solid #fff;
    border-radius: 50%;
    transition: all 0.3s ease;
}

.milestone-marker.reached {
    background-color: #00408F;
    transform: scale(1.2);
    box-shadow: 0 0 0 2px rgba(0, 64, 143, 0.3);
}

/* Mensagens motivacionais */
.ufpel-progress-message {
    font-size: 0.9rem;
}

.ufpel-progress-message.alert-success {
    background-color: rgba(40, 167, 69, 0.1);
    border-left: 4px solid #28a745;
    color: #155724;
}

.ufpel-progress-message.alert-info {
    background-color: rgba(0, 128, 255, 0.1);
    border-left: 4px solid #0080FF;
    color: #004085;
}

.ufpel-progress-message.alert-warning {
    background-color: rgba(247, 166, 0, 0.1);
    border-left: 4px solid #F7A600;
    color: #856404;
}

/* Responsividade */
@media (max-width: 576px) {
    .ufpel-course-progress-container {
        padding: 1rem;
    }
    
    .ufpel-progress-details .row {
        font-size: 0.8rem;
    }
    
    .milestone-marker {
        width: 6px;
        height: 6px;
    }
}

/* Animações */
@keyframes progressFill {
    from {
        width: 0%;
    }
}

.ufpel-progress-bar .progress-bar {
    animation: progressFill 1.5s ease-out;
}

/* Alto contraste */
@media (prefers-contrast: high) {
    .ufpel-course-progress-container {
        border: 2px solid #00408F;
    }
    
    .milestone-marker {
        border-width: 3px;
    }
}

/* Movimento reduzido */
@media (prefers-reduced-motion: reduce) {
    .ufpel-progress-bar .progress-bar,
    .milestone-marker {
        transition: none;
        animation: none;
    }
    
    .progress-bar-animated {
        animation: none;
    }
}
</style>
{{/has_progress}}